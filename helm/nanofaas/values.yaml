# Default namespace is the Helm release namespace; this chart can optionally
# create the namespace object for convenience.
namespace:
  create: true
  name: nanofaas

controlPlane:
  replicaCount: 1
  image:
    repository: ghcr.io/miciav/nanofaas/control-plane
    tag: v0.13.1
    pullPolicy: IfNotPresent
  service:
    name: control-plane
    type: ClusterIP
    ports:
      http: 8080
      actuator: 8081
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 2Gi

rbac:
  create: true

serviceAccount:
  create: true
  name: nanofaas-control-plane

prometheus:
  # Install an internal Prometheus instance (OpenFaaS-style "bundled Prometheus").
  # This is meant for dev/POC and short retention; for long-term retention, scrape it externally.
  create: true
  image: prom/prometheus:v3.9.1
  retention: 15d
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  service:
    name: prometheus
    type: ClusterIP
    port: 9090
  pvc:
    enabled: false
    size: 10Gi
    storageClassName: ""
  rbac:
    create: true
  kubeletResourceMetrics:
    enabled: false
    # Resource metrics scrape uses the apiserver proxy and typically needs skipping TLS verification in dev clusters.
    insecureSkipVerify: true

  # Basic Prometheus scrape annotations (works with "classic" Prometheus scrapers).
  scrape:
    enabled: true
    path: /actuator/prometheus
    portName: actuator
  # Prometheus Operator integration (requires ServiceMonitor CRD installed).
  serviceMonitor:
    enabled: false
    interval: 15s
    scrapeTimeout: 10s
    additionalLabels: {}

demos:
  enabled: true
  # The job will register these functions via the control-plane API.
  # For DEPLOYMENT mode, the control-plane will provision Deployment/Service per function.
  functions:
    - name: word-stats-java
      image: ghcr.io/miciav/nanofaas/java-word-stats:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: json-transform-java
      image: ghcr.io/miciav/nanofaas/java-json-transform:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: word-stats-python
      image: ghcr.io/miciav/nanofaas/python-word-stats:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: json-transform-python
      image: ghcr.io/miciav/nanofaas/python-json-transform:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: word-stats-exec
      image: ghcr.io/miciav/nanofaas/bash-word-stats:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: json-transform-exec
      image: ghcr.io/miciav/nanofaas/bash-json-transform:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: word-stats-java-lite
      image: ghcr.io/miciav/nanofaas/java-lite-word-stats:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"
    - name: json-transform-java-lite
      image: ghcr.io/miciav/nanofaas/java-lite-json-transform:v0.13.1
      timeoutMs: 10000
      concurrency: 2
      queueSize: 50
      maxRetries: 3
      executionMode: DEPLOYMENT
      scalingConfig:
        strategy: INTERNAL
        minReplicas: 1
        maxReplicas: 5
        metrics:
          - type: in_flight
            target: "2"

  registerJob:
    image: curlimages/curl:latest
    backoffLimit: 6
    # If you have strict clusters, you may want to pin a non-latest tag for curl.
    ttlSecondsAfterFinished: 300
